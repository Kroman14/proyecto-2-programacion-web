<!-- Mis pedidos -->
<div class="container my-5">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h1 class="fw-bold mb-0"><i class="bi bi-bag-check me-2"></i>Mis pedidos</h1>
    <a href="/libros" class="btn btn-outline-primary"><i class="bi bi-arrow-left"></i> Seguir comprando</a>
  </div>

  {{#if error}}
    <div class="alert alert-warning">{{error}}</div>
  {{/if}}

  {{#if pedidos.length}}
    <div class="row g-4">
      {{#each pedidos}}
        <div class="col-12">
          <div class="card shadow-sm">
            <div class="card-body">
              <div class="d-flex justify-content-between align-items-start flex-wrap gap-2">
                <div>
                  <div class="fw-bold">Pedido #{{this.id}}</div>
                  <div class="text-muted small">{{formatDate this.fecha_pedido}}</div>
                  <span class="badge bg-secondary mt-2 text-capitalize">{{this.estado}}</span>
                </div>
                <div class="text-end">
                  <div class="h5 mb-0 text-success">${{this.total}}</div>
                </div>
              </div>

              {{#if this.detalles.length}}
                <hr>
                <div class="table-responsive">
                  <table class="table align-middle">
                    <thead>
                      <tr>
                        <th></th>
                        <th>Libro</th>
                        <th>Cantidad</th>
                        <th>Precio</th>
                        <th>Subtotal</th>
                      </tr>
                    </thead>
                    <tbody>
                      {{#each this.detalles}}
                        <tr>
                          <td style="width: 56px;">
                            {{#if this.libro.imagen}}
                              <img src="{{this.libro.imagen}}" class="img-thumbnail" style="width:48px;height:48px;object-fit:cover" onerror="this.style.display='none'">
                            {{/if}}
                          </td>
                          <td>
                            <a href="/libro/{{this.libro.id}}" class="text-decoration-none">{{this.libro.titulo}}</a>
                          </td>
                          <td>{{this.cantidad}}</td>
                          <td>${{this.precio_unitario}}</td>
                          <td>${{this.subtotal}}</td>
                        </tr>
                      {{/each}}
                    </tbody>
                  </table>
                </div>
              {{/if}}
            </div>
          </div>
        </div>
      {{/each}}
    </div>
  {{else}}
    <div class="text-center py-5">
      <i class="bi bi-bag text-muted" style="font-size: 4rem;"></i>
      <h3 class="text-muted mt-3">Aún no tienes pedidos</h3>
      <p class="text-muted">Cuando realices una compra, verás el detalle aquí.</p>
      <a href="/libros" class="btn btn-primary"><i class="bi bi-search"></i> Explorar libros</a>
    </div>
  {{/if}}
</div>


