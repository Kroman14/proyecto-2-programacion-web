<!-- Hero Section -->
<section class="hero-section bg-gradient-primary text-black py-5">
    <div class="container">
        <div class="row align-items-center">
            <div class="col-lg-6">
                <h1 class="display-4 fw-bold mb-4">
                    Descubre tu próxima aventura literaria
                </h1>
                <p class="lead mb-4">
                    Miles de libros esperando por ti. Desde clásicos hasta las últimas novedades, 
                    encuentra tu próxima lectura favorita en nuestra librería online.
                </p>
                <div class="d-flex gap-3">
                    <a href="/libros" class="btn btn-light btn-lg">
                        <i class="bi bi-search"></i> Explorar Catálogo
                    </a>
                    <a href="/categorias" class="btn btn-light btn-lg">
                        <i class="bi bi-tags"></i> Ver Categorías
                    </a>
                </div>
            </div>
            <div class="col-lg-6 text-center">
                <div class="hero-image">
                    <i class="bi bi-book display-1 text-light opacity-75"></i>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Libros Destacados -->
<section class="py-5">
    <div class="container">
        <div class="row mb-4">
            <div class="col-12 text-center">
                <h2 class="display-6 fw-bold">Libros Destacados</h2>
                <p class="text-muted">Los títulos más populares de nuestra colección</p>
            </div>
        </div>

        {{#if error}}
        <div class="alert alert-warning text-center" role="alert">
            <i class="bi bi-exclamation-triangle"></i> {{error}}
        </div>
        {{/if}}

        {{#if libros.length}}
        <div class="row g-4">
            {{#each libros}}
            <div class="col-md-6 col-lg-4">
                <a href="/libro/{{id}}" class="text-decoration-none">
                    <div class="card h-100 shadow-sm book-card">
                        <div class="card-body d-flex flex-column">
                            <div class="text-center mb-3">
                                {{#if imagen}}
                                <img src="{{imagen}}" 
                                     class="img-fluid rounded book-cover" 
                                     alt="{{titulo}}" 
                                     loading="lazy"
                                     style="max-width: 100%; height: 200px; object-fit: cover;"
                                     onerror="this.onerror=null; this.parentElement.innerHTML='<div class=\'bg-light rounded d-flex align-items-center justify-content-center\' style=\'height: 200px\'><div class=\'text-center\'><i class=\'bi bi-book text-muted display-4\'></i><br><small class=\'text-muted\'>Imagen no disponible</small></div></div>';">
                                {{else}}
                                <div class="bg-light rounded d-flex align-items-center justify-content-center" style="height: 200px">
                                    <div class="text-center">
                                        <i class="bi bi-book text-muted display-4"></i>
                                        <br><small class="text-muted">Sin imagen</small>
                                    </div>
                                </div>
                                {{/if}}
                            </div>
                            
                            <h5 class="card-title fw-bold text-dark">{{titulo}}</h5>
                            
                            {{#if Autor}}
                            <p class="card-text text-muted">
                                <i class="bi bi-person"></i> {{Autor.nombre}}
                            </p>
                            {{/if}}
                            
                            {{#if Categoria}}
                            <span class="badge bg-primary mb-2">{{Categoria.nombre}}</span>
                            {{/if}}
                            
                            <p class="card-text flex-grow-1 text-muted">
                                {{#if descripcion}}
                                    {{truncate descripcion 100}}
                                {{else}}
                                    Descripción no disponible
                                {{/if}}
                            </p>
                            
                            <div class="d-flex justify-content-between align-items-center mt-auto">
                                <span class="h5 text-success mb-0">{{formatPrice precio}}</span>
                                <button class="btn btn-primary btn-sm add-to-cart" 
                                        data-book-id="{{id}}"
                                        onclick="event.preventDefault(); event.stopPropagation(); addToCart({{id}}, '{{titulo}}', {{precio}}, '{{imagen}}');">
                                    <i class="bi bi-cart-plus"></i> Agregar
                                </button>
                            </div>
                        </div>
                    </div>
                </a>
            </div>
            {{/each}}
        </div>
        
        <div class="text-center mt-4">
            <a href="/libros" class="btn btn-outline-primary btn-lg">
                Ver Todos los Libros <i class="bi bi-arrow-right"></i>
            </a>
        </div>
        {{else}}
        <div class="text-center py-5">
            <i class="bi bi-book text-muted display-1"></i>
            <h4 class="text-muted mt-3">No hay libros disponibles</h4>
            <p class="text-muted">Intenta más tarde o contacta con soporte.</p>
        </div>
        {{/if}}
    </div>
</section>

<!-- Características -->
<section class="bg-light py-5">
    <div class="container">
        <div class="row g-4">
            <div class="col-md-4 text-center">
                <div class="feature-icon mb-3">
                    <i class="bi bi-truck display-4 text-primary"></i>
                </div>
                <h5>Envío Gratis</h5>
                <p class="text-muted">En pedidos superiores a $50.000</p>
            </div>
            <div class="col-md-4 text-center">
                <div class="feature-icon mb-3">
                    <i class="bi bi-shield-check display-4 text-primary"></i>
                </div>
                <h5>Compra Segura</h5>
                <p class="text-muted">Transacciones 100% seguras</p>
            </div>
            <div class="col-md-4 text-center">
                <div class="feature-icon mb-3">
                    <i class="bi bi-headset display-4 text-primary"></i>
                </div>
                <h5>Soporte 24/7</h5>
                <p class="text-muted">Estamos aquí para ayudarte</p>
            </div>
        </div>
    </div>
</section>

<!-- Newsletter -->
<section class="py-5">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-lg-8 text-center">
                <h3>¡Mantente al día!</h3>
                <p class="text-muted">Recibe las últimas novedades y ofertas especiales</p>
                <div class="row g-2 justify-content-center">
                    <div class="col-md-8">
                        <div class="input-group">
                            <input type="email" class="form-control" placeholder="Tu correo electrónico">
                            <button class="btn btn-primary" type="button">
                                Suscribirse
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Toast Container para notificaciones -->
<div id="toast-container" class="toast-container position-fixed top-0 end-0 p-3" style="z-index: 9999;"></div>

<!-- Estilos adicionales para las cards clicables -->
<style>
.book-card {
    transition: all 0.3s ease;
    cursor: pointer;
}

.book-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 8px 25px rgba(0,0,0,0.15) !important;
}

.book-card:hover .book-cover {
    transform: scale(1.05);
}

.book-cover {
    transition: transform 0.3s ease;
}

a .card {
    color: inherit;
}

a:hover .card {
    text-decoration: none;
}

.add-to-cart:hover {
    transform: scale(1.05);
}
</style>

<!-- JavaScript para el carrito -->
<script>
function addToCart(id, titulo, precio, imagen) {
    // Obtener carrito actual del localStorage
    let carrito = JSON.parse(localStorage.getItem('carrito')) || [];
    
    // Buscar si el libro ya existe en el carrito
    const existingItem = carrito.find(item => item.id === id);
    
    if (existingItem) {
        existingItem.cantidad += 1;
    } else {
        carrito.push({
            id: id,
            titulo: titulo,
            precio: precio,
            imagen: imagen,
            cantidad: 1
        });
    }
    
    // Guardar en localStorage
    localStorage.setItem('carrito', JSON.stringify(carrito));
    
    // Mostrar confirmación
    showToast(`"${titulo}" agregado al carrito`, 'success');
    
    // Actualizar contador del carrito si existe
    updateCartCounter();
}

// Función para mostrar notificaciones toast
function showToast(message, type = 'info') {
    const toastContainer = document.getElementById('toast-container');
    if (!toastContainer) {
        // Crear contenedor de toasts si no existe
        const container = document.createElement('div');
        container.id = 'toast-container';
        container.className = 'toast-container position-fixed top-0 end-0 p-3';
        container.style.zIndex = '9999';
        document.body.appendChild(container);
    }

    const toastId = 'toast-' + Date.now();
    const toastHtml = `
        <div id="${toastId}" class="toast" role="alert" aria-live="assertive" aria-atomic="true">
            <div class="toast-header bg-${type} text-white">
                <strong class="me-auto">Notificación</strong>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="toast" aria-label="Close"></button>
            </div>
            <div class="toast-body">
                ${message}
            </div>
        </div>
    `;

    toastContainer.innerHTML += toastHtml;
    const toastElement = document.getElementById(toastId);
    
    if (typeof bootstrap !== 'undefined' && bootstrap.Toast) {
        const toast = new bootstrap.Toast(toastElement);
        toast.show();
    } else {
        // Fallback si Bootstrap no está disponible
        toastElement.style.display = 'block';
        setTimeout(() => {
            toastElement.remove();
        }, 3000);
    }
}

function updateCartCounter() {
    // Usar la función global si está disponible
    if (typeof window.updateCartCounter === 'function') {
        window.updateCartCounter();
    } else {
        // Fallback local
        const carrito = JSON.parse(localStorage.getItem('carrito')) || [];
        const totalItems = carrito.reduce((sum, item) => sum + item.cantidad, 0);
        
        const cartCounters = document.querySelectorAll('.cart-counter');
        cartCounters.forEach(counter => {
            counter.textContent = totalItems;
            counter.style.display = totalItems > 0 ? 'inline' : 'none';
        });
    }
}

// Inicializar contador al cargar la página
document.addEventListener('DOMContentLoaded', function() {
    updateCartCounter();
});
</script>
