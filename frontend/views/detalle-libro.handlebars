<!-- Detalle del libro -->
<div class="container mt-5">
  <!-- Breadcrumb -->
  <nav aria-label="breadcrumb" class="mb-4">
    <ol class="breadcrumb">
      <li class="breadcrumb-item"><a href="/" class="text-decoration-none">Inicio</a></li>
      <li class="breadcrumb-item"><a href="/libros" class="text-decoration-none">Catálogo</a></li>
      <li class="breadcrumb-item active" aria-current="page">{{libro.titulo}}</li>
    </ol>
  </nav>

  {{#if libro}}
    <!-- Detalle del libro -->
    <div class="row g-5">
      <!-- Imagen del libro -->
      <div class="col-lg-5">
        <div class="book-image-container">
          <div class="position-relative">
            <img src="{{libro.imagen}}" 
                 class="img-fluid rounded shadow-lg" 
                 alt="Portada de {{libro.titulo}}"
                 style="width: 100%; max-width: 400px; height: auto; object-fit: cover;"
                 onerror="this.src='https://placehold.co/400x600/6c757d/ffffff?text=Sin+Imagen'">
            
            <!-- Badge de precio -->
            <div class="position-absolute top-0 end-0 m-3">
              <span class="badge bg-success fs-6 px-3 py-2 rounded-pill">
                ${{libro.precio}}
              </span>
            </div>
            
            <!-- Badge de disponibilidad -->
            <div class="position-absolute bottom-0 start-0 m-3">
              <span class="badge bg-primary fs-6 px-3 py-2 rounded-pill">
                <i class="fas fa-check-circle"></i> Disponible
              </span>
            </div>
          </div>
        </div>
      </div>

      <!-- Información del libro -->
      <div class="col-lg-7">
        <div class="book-details">
          <!-- Título y autor -->
          <div class="mb-4">
            <h1 class="display-5 fw-bold text-primary mb-3">{{libro.titulo}}</h1>
            <p class="lead text-secondary mb-2">
              <i class="fas fa-user text-primary"></i> 
              <strong>Autor:</strong> {{libro.autor.nombre}}
            </p>
            {{#if libro.categoria}}
              <p class="text-secondary mb-3">
                <i class="fas fa-tag text-primary"></i> 
                <strong>Categoría:</strong> 
                <span class="badge bg-light text-dark border">{{libro.categoria.nombre}}</span>
              </p>
            {{/if}}
          </div>

          <!-- Descripción -->
          <div class="mb-4">
            <h3 class="h4 text-primary mb-3">
              <i class="fas fa-book-open"></i> Descripción
            </h3>
            <div class="description-text">
              {{#if libro.descripcion}}
                <p class="text-muted lh-lg">{{libro.descripcion}}</p>
              {{else}}
                <p class="text-muted lh-lg">
                  Una obra fascinante que te transportará a mundos únicos y experiencias inolvidables. 
                  Descubre esta increíble historia que ha cautivado a lectores de todo el mundo.
                </p>
              {{/if}}
            </div>
          </div>

          <!-- Información adicional -->
          <div class="mb-4">
            <h3 class="h4 text-primary mb-3">
              <i class="fas fa-info-circle"></i> Información adicional
            </h3>
            <div class="row g-3">
              <div class="col-sm-6">
                <div class="info-card p-3 bg-light rounded">
                  <div class="d-flex align-items-center">
                    <i class="fas fa-dollar-sign text-success fs-4 me-3"></i>
                    <div>
                      <small class="text-muted d-block">Precio</small>
                      <strong class="h5 text-success mb-0">${{libro.precio}}</strong>
                    </div>
                  </div>
                </div>
              </div>
              <div class="col-sm-6">
                <div class="info-card p-3 bg-light rounded">
                  <div class="d-flex align-items-center">
                    <i class="fas fa-calendar text-info fs-4 me-3"></i>
                    <div>
                      <small class="text-muted d-block">Agregado</small>
                      <strong class="text-dark">{{formatDate libro.createdAt}}</strong>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Botones de acción -->
          <div class="action-buttons">
            <div class="row g-3">
              <div class="col-12">
                <button class="btn btn-success btn-lg w-100 py-3 add-to-cart-btn" 
                        data-libro-id="{{libro.id}}"
                        data-libro-titulo="{{libro.titulo}}"
                        data-libro-precio="{{libro.precio}}">
                  <i class="fas fa-shopping-cart me-2"></i>
                  Agregar al Carrito
                </button>
              </div>
              <div class="col-sm-6">
                <button class="btn btn-outline-primary w-100 py-2 add-to-cart"
                        data-id="{{libro.id}}"
                        data-title="{{libro.titulo}}"
                        data-price="{{libro.precio}}"
                        data-image="{{libro.imagen}}">
                  <i class="fas fa-heart me-2"></i>
                  Agregar también
                </button>
              </div>
              <div class="col-sm-6">
                <button class="btn btn-outline-secondary w-100 py-2">
                  <i class="fas fa-share-alt me-2"></i>
                  Compartir
                </button>
              </div>
            </div>
          </div>

          <!-- Mensaje de éxito -->
          <div id="cart-success-message" class="alert alert-success mt-3 d-none" role="alert">
            <i class="fas fa-check-circle me-2"></i>
            ¡Libro agregado al carrito exitosamente!
          </div>
        </div>
      </div>
    </div>

  {{else}}
    <!-- Libro no encontrado -->
    <div class="row">
      <div class="col-12 text-center">
        <div class="alert alert-warning p-5" role="alert">
          <i class="fas fa-exclamation-triangle fs-1 text-warning mb-3"></i>
          <h2 class="alert-heading">Libro no encontrado</h2>
          <p class="mb-4">Lo sentimos, el libro que buscas no existe o no está disponible en este momento.</p>
          <div class="d-flex justify-content-center gap-3">
            <a href="/libros" class="btn btn-primary">
              <i class="fas fa-search me-2"></i>
              Explorar catálogo
            </a>
            <a href="/" class="btn btn-outline-primary">
              <i class="fas fa-home me-2"></i>
              Volver al inicio
            </a>
          </div>
        </div>
      </div>
    </div>
  {{/if}}
</div>

<!-- Estilos adicionales -->
<style>
.book-image-container {
  position: sticky;
  top: 20px;
}

.book-details {
  height: 100%;
}

.info-card {
  transition: transform 0.2s ease, box-shadow 0.2s ease;
  border: 1px solid #e9ecef;
}

.info-card:hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(0,0,0,0.1);
}

.add-to-cart-btn {
  transition: all 0.3s ease;
  position: relative;
  overflow: hidden;
}

.add-to-cart-btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 25px rgba(40, 167, 69, 0.3);
}

.add-to-cart-btn:active {
  transform: translateY(0);
}

.description-text {
  max-height: 200px;
  overflow-y: auto;
}

.breadcrumb-item + .breadcrumb-item::before {
  content: "›";
  font-weight: bold;
}

@media (max-width: 991px) {
  .book-image-container {
    position: relative;
    top: auto;
    text-align: center;
    margin-bottom: 2rem;
  }
  
  .book-image-container img {
    max-width: 300px;
  }
}

@media (max-width: 576px) {
  .display-5 {
    font-size: 2rem;
  }
  
  .action-buttons .col-sm-6 {
    margin-top: 0.5rem;
  }
}
</style>

<!-- JavaScript para funcionalidad del carrito -->
<script>
document.addEventListener('DOMContentLoaded', function() {
  const addToCartBtn = document.querySelector('.add-to-cart-btn');
  const successMessage = document.getElementById('cart-success-message');
  
  if (addToCartBtn) {
    addToCartBtn.addEventListener('click', function() {
      const libroId = this.dataset.libroId;
      const libroTitulo = this.dataset.libroTitulo;
      const libroPrecio = this.dataset.libroPrecio;
      
      // Animación del botón
      const originalText = this.innerHTML;
      this.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>Agregando...';
      this.disabled = true;
      
      // Simular llamada al carrito (aquí iría la lógica real)
      setTimeout(() => {
        // Agregar al localStorage como carrito temporal
        let carrito = JSON.parse(localStorage.getItem('carrito')) || [];
        
        // Verificar si el libro ya está en el carrito
        const existingItem = carrito.find(item => item.id === libroId);
        
        if (existingItem) {
          existingItem.cantidad += 1;
        } else {
          carrito.push({
            id: libroId,
            titulo: libroTitulo,
            precio: libroPrecio,
            cantidad: 1
          });
        }
        
        localStorage.setItem('carrito', JSON.stringify(carrito));
        
        // Mostrar mensaje de éxito
        successMessage.classList.remove('d-none');
        
        // Restaurar botón
        this.innerHTML = originalText;
        this.disabled = false;
        
        // Ocultar mensaje después de 3 segundos
        setTimeout(() => {
          successMessage.classList.add('d-none');
        }, 3000);
        
        // Actualizar contador del carrito si existe
        updateCartCounter();
        
      }, 1000);
    });
  }
  
  // Función para actualizar contador del carrito
  function updateCartCounter() {
    const carrito = JSON.parse(localStorage.getItem('carrito')) || [];
    const totalItems = carrito.reduce((sum, item) => sum + item.cantidad, 0);
    
    const cartCounters = document.querySelectorAll('.cart-counter');
    cartCounters.forEach(counter => {
      counter.textContent = totalItems;
      counter.style.display = totalItems > 0 ? 'inline' : 'none';
    });
  }
  
  // Funcionalidad para botones adicionales
  const favoriteBtn = document.querySelector('.btn-outline-primary');
  const shareBtn = document.querySelector('.btn-outline-secondary');
  
  if (favoriteBtn && favoriteBtn.innerHTML.includes('favoritos')) {
    favoriteBtn.addEventListener('click', function() {
      const icon = this.querySelector('.fas');
      if (icon.classList.contains('fa-heart')) {
        icon.classList.remove('fa-heart');
        icon.classList.add('fa-heart-broken');
        this.classList.remove('btn-outline-primary');
        this.classList.add('btn-outline-danger');
        this.innerHTML = '<i class="fas fa-heart-broken me-2"></i>Quitar de favoritos';
      } else {
        icon.classList.remove('fa-heart-broken');
        icon.classList.add('fa-heart');
        this.classList.remove('btn-outline-danger');
        this.classList.add('btn-outline-primary');
        this.innerHTML = '<i class="fas fa-heart me-2"></i>Añadir a favoritos';
      }
    });
  }
  
  if (shareBtn) {
    shareBtn.addEventListener('click', function() {
      if (navigator.share) {
        navigator.share({
          title: '{{libro.titulo}}',
          text: 'Mira este libro: {{libro.titulo}} por {{libro.autor.nombre}}',
          url: window.location.href
        });
      } else {
        // Fallback para navegadores que no soportan Web Share API
        navigator.clipboard.writeText(window.location.href).then(() => {
          const originalText = this.innerHTML;
          this.innerHTML = '<i class="fas fa-check me-2"></i>¡Enlace copiado!';
          setTimeout(() => {
            this.innerHTML = originalText;
          }, 2000);
        });
      }
    });
  }
  
  // Inicializar contador del carrito al cargar la página
  updateCartCounter();
});
</script>
